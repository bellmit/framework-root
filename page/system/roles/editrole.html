<div id="editrole" class="div_detail">
	<form id="roleform" name="roleform">
		<div style="margin-top: 10px">
			<fieldset>
				<legend>角色信息</legend>

				<input type="hidden" id="roleid" name='roleid'
					value="${role.roleid!''}" />
				<table>
					<tr>
						<td align="right"><label>角色名称：</label></td>
						<td><input type="text" id="rolename" name="rolename"
							data-label="角色名称" value="${role.rolename!''}" required
							placeholder="enter content" /></td>

					</tr>
					<tr>
						<td>描述：</td>
						<td><input type="text" id="roledesc" name="roledesc"
							value="${role.roledesc!''}" /></td>
					</tr>
				</table>

			</fieldset>
		</div>
		<div style="height: 335px" class="divleft-right">
			<div style="width:250px;" class="divleft">
				<fieldset>
					<legend>菜单权限</legend>
					<legend style="left:150px;"><label for="check">全选</label><input type="checkbox" id="check_menu"></legend>
					<div style="overflow: auto; height:300px;">
						<ul id="moduleTree" class="ztree"></ul>
					</div>
				</fieldset>
			</div>
			<div style="width:475px"  class="divright">
				<fieldset>
					<legend>功能权限</legend>
					<legend style="left:150px;"><label for="check">全选</label><input type="checkbox" id="check_fun"></legend>
					<div style="height:300px;">
					</div>
				</fieldset>
			</div>
		</div>
	</form>
</div>
<script type=text/javascript>
	var roleEditJscript = {
		init_UI : function() {
			$(".div_detail",arguments[0]).detail({handleForm:"#roleform"});
		    $("#check_menu").click(function(){
		    	
		    	roleEditJscript.zTree.checkAllNodes(this.checked);
		    });
		},
		zTree:null,
		setting:homepage.treesetting,		
		init_tree : function(treeData) {
			this.zTree = $.fn.zTree.init($("#moduleTree"), this.setting, treeData);
		},
		getcheck:function(){
			var nodes = this.zTree.getCheckedNodes(true);
			return nodes;
		},
		roleSave:function(callback){
			var isValid= $("#editrole").detail("checkValidation");
			if (!isValid)
				return false;
			var nodes = this.getcheck();
			var data = $("#roleform").serializeArray();
			var modids=new Array(nodes.length);
			$.each(nodes, function(i, node){
				 modids[i] = node.id;
			});
			data[data.length+1] = {name:'modids',value:modids};
			
			$.post(homepage.sysContextPath + "/system/role/updateRole",data,function(data){
				if(data.successRows > 0 ){
					$(".scrollPageBar").toolbar("refresh");
					alert("数据保存成功！");
					if (callback!=undefined && $.isFunction(callback))
						callback();
				}else{
					alert("数据保存失败！");
				}
			});
			
		}
	};
	
	$(function() {
		roleEditJscript.init_UI();
		roleEditJscript.init_tree(${treeModules});
	});
</script>
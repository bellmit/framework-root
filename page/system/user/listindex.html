<script type=text/javascript>
	var userJscript = {
		dialogObj:null,
		init_UI : function() {
			var queryAreaHeight = 0 - $(".queryarea").height();
			$("#systemData").adaptParentHeight(queryAreaHeight);
		},
		showEditUser : function(isEdit) {
			
			var _params = {};
			
			if (isEdit){
				console.log("1");
				
				var selectValue =  $(".divgridtable").gridtable("checkValue");
				console.log("2");
				if (selectValue==null || selectValue == '' || selectValue.length <=0){
					alert("请选择要编辑的数据");
					return ;
				}
				console.log("3");
				_params = {'userid':selectValue[0]};
				console.log("4");
			}
			
			var dialogP = {
				height : 500,
				width : 700,
				title : "用户编辑",
				buttons : {
					'保存' : function() {
						var $that = $(this);
						userJscript.dialogObj.userSave(function(){
							$that.dialogE( "close" );
						});
					}
				},
				args:_params,
				callback:function(){
					userJscript.dialogObj =userEditJscript;
				}
			};
			$.openDialog(homepage.sysContextPath + "/system/user/showEditUser",
					dialogP);
		},
		delUser:function(){
			
			var selectValue =  $("#usergrid").gridtable("checkValue");
			
			if (selectValue==null || selectValue == '' || selectValue.length <=0){
				alert("请选择要删除的数据");
				return ;
			}
			if (!confirm("您确定删除这些数据吗？"))
				return ;
			 var data = {ids:selectValue};
			 $.post(homepage.sysContextPath + "/system/user/deleteUser",data,function(data){
				if(data.successRows > 0 ){
					$(".scrollPageBar").toolbar("refresh");
					alert("数据删除成功！");
					$that.dialogE( "close" );
				}
			});  
		},
		findUser:function(){
			var data = $("#queryForm").serialize();
			$.divLoad("#systemData",homepage.sysContextPath + "/system/user/list",data,function(data){
				
			});
			
		}
	};

	$(function() {
		userJscript.init_UI();
		
	});
</script>

<!-- 查询区域 -->
<div class="queryarea content" style="height:30px;">
	<form id="queryForm">
	<table>
		<tr>
			<td><label for="username">姓名：</label></td>
			<td><input name="param['username']" id="param['username']" value=""/></td>
			<td><label for="logincode">登录名：</label></td>
			<td><input name="param['logincode']" id="param['logincode']" value=""/></td>
			<td><button type="button" title="查询" data-icon="ui-icon-arrowreturnthick-1-w" onclick="userJscript.findUser();" value="查询">查询</button></td>
		</tr>
	</table>
	</form>
</div>

<!-- 数据显示区域 -->
<div id="systemData" class="dataarea">
	<div class="toolbar" id="testtoolbar">
		<input id="" type="button" value="新增"
			onclick="userJscript.showEditUser();" /> 
		<input id="" type="button" data-icon="ui-icon-wrench"
			value="修改" onclick="userJscript.showEditUser(true);" />
		<button id="button" title="删除" value="删除"
			data-icon="ui-icon-arrowreturnthick-1-w" onclick="userJscript.delUser();">删除</button>
	</div>
	<div class="divgridtable" id="usergrid" data-checkbox="#chk_select">
		<table style="width: 100%">
		<thead>
			<tr>
				<td style="width: 20px;"><input type="checkbox" id="chk_select"
					data-subcheck="subcheck" /></td>
				<td style="width: 100px;">姓名</td>
				<td style="width: 100px;">登录名</td>
				<td style="width: 40px;">性别</td>
				<td style="width: 100px;">电话</td>
				<td style="width: 100px;">Email</td>
				<td>地址</td>
			</tr>
		</thead>
		<#if page.pageDatas??> <#list page.pageDatas as user>
		<tr>
			<td><input type="checkbox" name="subcheck" value="${(user.userid)!}"></td>
				<td>${user.username?html}</td>
				<td>${user.logincode?html}</td>
				<td><#if '${(user.gender)!}' == "1">男<#else>女</#if></td>
				<td>${(user.phone)!}</td>
				<td>${(user.email)!}</td>
				<td>${(user.address)!}</td>
		</tr>
		</#list> </#if>
	</table>
	</div>
	<div class="scrollPageBar" data-curpage="${page.curPage}" data-totalpage="${page.lastPage}" data-param="{}"
		data-recordcount="${page.pageSize}" data-linktarget="systemData" data-pagelink="<@pub.projectpath/>/system/user/list"></div>
</div>
